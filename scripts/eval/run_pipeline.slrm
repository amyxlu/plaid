#!/usr/bin/env bash

#SBATCH --job-name pipeline 
#SBATCH --nodes 1 
#SBATCH --gpus-per-node 1 
#SBATCH --partition gpu2
#SBATCH --cpus-per-gpu 4 
#SBATCH --mem 30G
#SBATCH --time=1-00:00:00

source ~/.bashrc
eval "$(mamba shell.bash hook)"

echo "SLURM_JOB_NODELIST = ${SLURM_JOB_NODELIST}"
echo "SLURM_JOB_ID = ${SLURM_JOB_ID}"
echo "SLURMD_NODENAME = ${SLURMD_NODENAME}"
echo "SLURM_JOB_NUM_NODES = ${SLURM_JOB_NUM_NODES}"

export HYDRA_FULL_ERROR=1

cd /homefs/home/lux70/code/plaid/pipeline

nvidia-smi

mamba activate plaid 
mamba env list
echo $CONDA_PREFIX

srun python run_pipeline.py $@

# for len in $@; do
#     python run_pipeline.py experiment=bs16 ++sample.length=$len ++sample.num_samples=64 ++sample.output_root_dir="/data/lux70/plaid/artifacts/samples/by_length/${len}"
# done

